# 42장 비동기 프로그래밍

# 42.1 동기 처리와 비동기 처리

자바스크립트 엔진은 단 하나의 실행 컨텍스트를 갖기 때문에 한번에 한가지 작업만 가능하다. 때문에 오래 걸리는 작업을 실행 하는 경우 블로킹(작업 중단)이 발생한다.

동기 처리 방식은 앞선 작업이 종료되면 다음 작업을 시작한다. 따라서 순서대로 처리 하지만 앞 작업이 끝나기 전까지 다음 작업을 못한다.

비동기 처리 방식은 블로킹이 발생하진 읺지만 작업 순서를 보장할 수 없다.

# 42.2 이벤트 루프와 태스크 큐

자바스크립트는 싱글 스레드지만 브라우저가 동작하는 걸 보면 여러 작업을 한번에 하는 듯 하다. 이것을 가능케 하는 것이 이벤트 루프이다. 이벤트 루프는 브라우저에 기본적으로 내장된 기능이다.

대부분의 자바스크립트 엔진은 두 가지 영역으로 나눌 수 있다.

- 콜 스택 : 소스코드가 평가되어 생성된 실행 컨텍스트를 추가하고 제거하는 스택 자료구조이다.
- 힙 : 객체가 저장되는 메모리 공간으로 콜 스택의 요소인 실행 컨텍스트는 힙에 저장된 객체를 참조한다.

자바스크립트 엔진은 태스크가 요청되면 콜 스택을 통해 요청된 작업을 순차적으로 실행한다. 비동기 처리에서 소스코드의 평가와 실행을 제외한 모든 처리는 브라우저 혹은 런타임인 Node.js 가 담당한다.

- 태스크 큐 : setTimeout 이나 setInterval과 같은 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역
- 이벤트 루프 : 이벤트 루프는 현재 실행 중인 실행 컨텍스트가 있는지, 그리고 태스크 큐에 대기 중인 함수가 있는지 반복해서 확인한다. 만약 콜 스택이 비어있고 태스크 큐에 대기 중인 함수가 있다면 이벤트 루프는 순차적으로 태스크 큐에 대기 중인 함수를 콜 스택으로 이동시킨다. 이 때 콜 스택으로 이동한 함수는 실행된다. 즉, 태스크 큐에 일시 보관된 함수들은 비동기적으로 동작한다.

정리하자면 태스크 큐에 비동기 작업들이 쌓이고 이벤트루프가 이를 콜 스택으로 이동시켜 작업을 처리한다는 것이다.

기억 해야 할 점은 자바스크립트 엔진이 싱글 스레드를 가지고 있기 때문에 비동기 작업이 불가능 하지만 브라우저는 멀티 스레드이기 때문에 비동기 처리가 가능 한 것이다. 만약 브라우저도 싱글 스레드라면 비동기 ㅊ처리를 위한 타이머가 작동 중일 때에는 타이머 작업 단 하나면 가능 하기 때문에 타이머가 만료 될 때 까지 다른 작업을 하지 못한다.
