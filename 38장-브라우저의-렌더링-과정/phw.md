# 38장 브라우저의-렌더링-과정

## 브라우저의 렌더링 과정

1. html, css, js 등 렌더링에 필요한 리소스를 요청하고 서버에서 응답받는다.
2. 브라우저의 렌더링 엔진은 서버에서 응답된 html, css를 파싱하여 dom 과 cssom을 생성하고 이를 결합하여 렌더 트리를 생성한다.
   - html 을 파싱하는 도중 외부 리소스를 로드하는 태그(link, img, script)등을 만나면 html을 일시 중단하고 리소스 파일을 서버로 요청한다
3. 브라우저의 자바스크립트 엔진은 서버에서 받은 js를 파싱해 ast를 생성하고 바이트 코드로 변환해 실행한다. 이때 자바스크립트가 변경한 dom, cssom은 다시 렌더 트리에 결합된다
4. 렌더 트리를 기반으로 thml 요소의 레이아웃을 계산하고 브라우저 화면에 html 요소를 페인팅한다.

- 루트 요청 : 스킴과 호스트 만으로 구성된 URI에 의한 요청
  - 일반적인 경우 암묵적으로 index.html을 응답하도록 기본 설정되어 있다.
  - 다른 정적 파일을 요청하려면 브라우저 주소창에 요청할 파일의 경로와 파일 이름을 URI의 호스트 뒤의 패스에 기술해 요청한다.

## HTTP 1.1, HTTP 2.0

HTTP : 웹에서 브라우저와 서버가 통신하기 위한 프로토콜

### 차이점

- HTTP/1.1은 기본적으로 커넥션당 하나의 요청과 응답만 처리한다

  - link, img, script 태그등에 의한 리소스 요청이 개별적으로 전송되고 응답또한 개별적으로 전송된다.
  - 리소스의 동시전송 불가능 -> 리소스 개수에 비례해 응답 시간 증가

- HTTP/2 는 커넥션당 여러개 즉 다중 요청응답이 가능하다.
  - HTTP/1.1에 비해 페이지 로드속도가 약 50% 빠르다고 알려져있다.

### HTML 파싱과 DOM 생성

> DOM : 순수 텍스트인 html 문서를 브라우저에 시각적인 픽셀로 렌더링 하기 위해 필요한 브라우저가 이해할 수 있는 자료구조

- 파싱 과정 : 바이트 -> 문자 -> 토큰 -> 노드 -> DOM
- DOM은 곧 html 문서를 파싱한 결과물이다.

### CSS 파싱과 CSSOM 생성

- HTML과 같은 파싱과정을 거쳐 해석하여 CSSOM을 만든다.
- css파싱을 완료하면 html 파싱의 중단 지점부터 다시 html을 파싱해 dom 생성을 재개한다

### 렌더트리 생성

> 렌더트리 : 렌더링을 위한 트리 구조의 자료구조(렌더링되지 않는 노드들은 포함되지 않는다)

- DOM 과 CSSOM이 결합되어져 만든 렌더트리는 각 HTML요소의 레이아웃을 계산하는데 쓰인다. 그 후 브라우저 화면에 픽셀을 렌더링하는 페인팅 처리에 입력된다.

- 반복해서 레이아웃 계산과 페인팅이 재차 실행되는 경우
  1. 자바스크립트에 의한 노드 추가 삭제
  1. 브라우저 창의 리사이징에 의한 뷰포트 크기 변경
  1. html 요소의 레이아웃 크기 변경을 발생시키는 스타일 변경

### 자바스크립트 파싱과 실행

- HTML 파싱중 js 파일을 로드하거나 js 코드를 담은 script 태그를 만나면 dom 생성을 일시 중단한다.

- script 태그의 src 어트리뷰트에 정의된 js 파일을 서버에 요청해 로드한 자바스크립트 파일이나 script 태그 내의 자바스크립트 코드를 파싱하기 위해 자바스크립트 엔진에 제어권을 넘긴다.

- js 의 파싱과 실행은 자바스크립트 엔진이 처리한다 (렌더링 엔진 X)

- js 엔진은 js 를 해석해 AST(추상적 구문 트리)를 생성한다.
  - 이를 기반으로 인터프리터가 실행 할 수 있는 중간코드인 바이트코드를 생성하고 실행한다.

### 리플로우와 리페인트

- 리플로우 : 레이아웃 계산을 다시하는것, 레이아웃에 영향을 주는 변경이 발생한 경우에 한하여 실행

  - 노드 추가삭제, 요소 크기 위치 변경, 윈도우 리사이징 등

- 리페인트 : 재결합된 렌더 트리를 기반으로 다시 페인트 하는 것

### async/defer Attribute

- js 파싱에 의한 DOM 생성 중단의 문제를 해결하기 위한 HTML5 이상 사양의 속성

- src 어트리뷰트로 외부 js 를 로드하는 경우에만 사용

- html 파싱과 외부 js 파일의 로드가 비동기적으로 동시에 진행

- async : js 파싱, 실행은 js 파일의 로드가 완료된 직후 진행되고 이때 html 파싱 중단

- defer : html 파싱 즉 dom 생성이 완료된 직후 js 의 파싱, 실행이 진행됨
